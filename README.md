# healthcheck-service

**[1] Конфигурация приложения:**

Во время своей работы приложение использует 2 конфигурационных файла - **settings.yml** и **urls.yml**.
Имена конфигурационных файлов можно сменить флагом (описаны ниже в пункте 2). 

Конфигурационный файл **urls.yml** содержит описания адресов, а также типы проверок, которые необходимо совершить
для конкретного адреса. Помимо типов проверок можно указать минимальное количество успешных проверок, при котором
работоспособность сайта будет считаться как **OK**.

Пример файла **urls.yml**:

```
urls:
  - url: "http://ya.ru"
    checks: ["status_code", "text"]
    min_checks_cnt: 2
```

- url - адрес проверки, **string**;
- checks - массив типов проверок для адреса url, **[]string**;
- min_check_cnt - минимальное количество успешных проверок, **int**.

Конфигурационный файл **settings.yml** содержит различные внутренние настройки приложения. Например, 
как подключиться к БД (**для простоты запуска приложения оставлены в конфигурационном файле, корректнее
перенести в переменные окружения**), на каком порте запустить сервер и т.д.

Пример файла **settings.yml**:

```
logger:
  log_file_path: ../logs/log.txt
  debug: false
  max_size_mb: 10
  max_backups: 2
  max_age_days: 30
  local_time: true
  compress: true # архивирование при превышении лимита файла
db: # postgresql
  db_name: healthcheck
  db_host: localhost
  db_port: 5432
  db_user: postgres
  db_password: postgres
check_interval_sec: 10
server:
  port: 11000
```

**[2] Режимы работы приложения:**

Приложение способно работать в одном из 4 режимов согласно ТЗ в файле **INFO.md**:
- одиночный проход, **single mode**;
- одиночный проход с выписыванием результатов в БД и отправкой уведомлений, **with db mode**;
- режим циклического запуска проверок с выпиской результатов в БД и отправкой уведомлений, **cycle mode**;
- режим полноценного API сервиса, где к предыдущим этапам добавлена возможность получить последние результаты в ответ на запрос, **api mode**.

**[2.1] Запуск и флаги:**

Подробные инструкции по запуску и работе с приложением можно получить, запустив его без переданных аргументов.

Команда запуска приложения в каком-либо из режимов, описанных в пункте 2: **run**. Пример:

```
app.exe run
```

Команда run принимает ряд дополнительных флагов:
- settings - флаг особого пути до файла настроек, по умолчанию = *"../configs/settings.yml"*;
- urls - флаг особого пути до конфигурационного файла URL, по умолчанию = *"../configs/urls.yml"*;
- mode - режим работы приложения, по умолчанию = *single*

Флаги режимов **mode** в соответствии с пунктом 2:
- single;
- withDB;
- cycle;
- api.

Пример запуска приложения с флагами:

```
app.exe run -mode=api -urls="../configs/urls2.yml"
```

*Значения по умолчанию выставляются, если флаг не был указан в строке запуска.*